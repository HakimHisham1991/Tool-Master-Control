@model CNCToolingDatabase.Models.ViewModels.PaginationViewModel
@{
    var sep = string.IsNullOrEmpty(Model.QueryBase) ? "" : "&";
    string PageUrl(int p, int ps) => "?" + Model.QueryBase + sep + "page=" + p + "&pageSize=" + ps;
}
<div class="pagination-wrapper" data-query-base="@Model.QueryBase" data-page-size="@Model.PageSize" data-total-pages="@Model.TotalPages">
    <div class="pagination">
        <div class="pagination-left">
            <span class="page-info">Showing @Model.StartRecord - @Model.EndRecord of @Model.TotalItems</span>
            <span class="page-size-select">
                <label for="pageSizeSelect">Rows per page:</label>
                <select id="pageSizeSelect" class="form-control form-control-sm">
                    @foreach (var opt in Model.PageSizeOptions)
                    {
                        if (opt == Model.PageSize)
                        {
                            <option value="@opt" selected>@opt</option>
                        }
                        else
                        {
                            <option value="@opt">@opt</option>
                        }
                    }
                </select>
            </span>
        </div>
        <div class="pagination-center">
            <div class="page-buttons">
                @if (Model.CurrentPage > 1)
                {
                    <a href="@PageUrl(Model.CurrentPage - 1, Model.PageSize)" class="btn btn-secondary btn-sm">Previous</a>
                }
                @foreach (var p in Model.GetPageNumbers())
                {
                    @if (p == -1 || p == -2)
                    {
                        <span class="page-ellipsis">...</span>
                    }
                    else
                    {
                        <a href="@PageUrl(p, Model.PageSize)" class="btn @(p == Model.CurrentPage ? "btn-primary" : "btn-secondary") btn-sm">@p</a>
                    }
                }
                @if (Model.CurrentPage < Model.TotalPages)
                {
                    <a href="@PageUrl(Model.CurrentPage + 1, Model.PageSize)" class="btn btn-secondary btn-sm">Next</a>
                }
            </div>
            <div class="jump-to-page">
                <label for="jumpPageInput">Jump to:</label>
                <input type="number" id="jumpPageInput" class="form-control form-control-sm" min="1" max="@Model.TotalPages" value="@Model.CurrentPage" placeholder="Page" />
                <button type="button" class="btn btn-secondary btn-sm btn-jump-go">Go</button>
            </div>
        </div>
        <div class="pagination-right">
            <span class="page-summary">Page @Model.CurrentPage of @Model.TotalPages</span>
        </div>
    </div>
</div>
<script>
(function(){
    var w = document.querySelector('.pagination-wrapper');
    if (!w) return;
    var qb = w.getAttribute('data-query-base') || '';
    var sep = qb ? '&' : '';
    var ps = w.getAttribute('data-page-size') || '50';
    var total = parseInt(w.getAttribute('data-total-pages') || '1', 10);
    var sel = w.querySelector('#pageSizeSelect');
    if (sel) sel.addEventListener('change', function() {
        window.location.href = '?' + qb + sep + 'page=1&pageSize=' + this.value;
    });
    var inp = w.querySelector('#jumpPageInput');
    var goBtn = w.querySelector('.btn-jump-go');
    if (inp && goBtn) {
        goBtn.addEventListener('click', function() {
            var p = parseInt(inp.value || '1', 10);
            if (p >= 1 && p <= total)
                window.location.href = '?' + qb + sep + 'page=' + p + '&pageSize=' + ps;
        });
        inp.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') { e.preventDefault(); goBtn.click(); }
        });
    }
})();
</script>
