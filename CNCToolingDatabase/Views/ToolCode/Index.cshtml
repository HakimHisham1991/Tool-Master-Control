@model ToolCodeListViewModel
@{
    ViewData["Title"] = "Tool Code Database with Tool List";
}

@{
    var toolCodeExportQ = new List<string> { "format=excel" };
    if (!string.IsNullOrEmpty(Model.SearchTerm)) toolCodeExportQ.Add("search=" + Uri.EscapeDataString(Model.SearchTerm));
    if (!string.IsNullOrEmpty(Model.ToolNumberFilter)) toolCodeExportQ.Add("toolNumber=" + Uri.EscapeDataString(Model.ToolNumberFilter));
    if (!string.IsNullOrEmpty(Model.ToolDescriptionFilter)) toolCodeExportQ.Add("toolDescription=" + Uri.EscapeDataString(Model.ToolDescriptionFilter));
    if (!string.IsNullOrEmpty(Model.ConsumableCodeFilter)) toolCodeExportQ.Add("consumableCode=" + Uri.EscapeDataString(Model.ConsumableCodeFilter));
    if (!string.IsNullOrEmpty(Model.SupplierFilter)) toolCodeExportQ.Add("supplier=" + Uri.EscapeDataString(Model.SupplierFilter));
    if (!string.IsNullOrEmpty(Model.HolderExtensionFilter)) toolCodeExportQ.Add("holderExtension=" + Uri.EscapeDataString(Model.HolderExtensionFilter));
    if (!string.IsNullOrEmpty(Model.DiameterFilter)) toolCodeExportQ.Add("diameter=" + Uri.EscapeDataString(Model.DiameterFilter));
    if (!string.IsNullOrEmpty(Model.FluteLengthFilter)) toolCodeExportQ.Add("fluteLength=" + Uri.EscapeDataString(Model.FluteLengthFilter));
    if (!string.IsNullOrEmpty(Model.ProtrusionLengthFilter)) toolCodeExportQ.Add("protrusionLength=" + Uri.EscapeDataString(Model.ProtrusionLengthFilter));
    if (!string.IsNullOrEmpty(Model.CornerRadiusFilter)) toolCodeExportQ.Add("cornerRadius=" + Uri.EscapeDataString(Model.CornerRadiusFilter));
    if (!string.IsNullOrEmpty(Model.ArborCodeFilter)) toolCodeExportQ.Add("arborCode=" + Uri.EscapeDataString(Model.ArborCodeFilter));
    if (!string.IsNullOrEmpty(Model.PartNumberFilter)) toolCodeExportQ.Add("partNumber=" + Uri.EscapeDataString(Model.PartNumberFilter));
    if (!string.IsNullOrEmpty(Model.OperationFilter)) toolCodeExportQ.Add("operation=" + Uri.EscapeDataString(Model.OperationFilter));
    if (!string.IsNullOrEmpty(Model.RevisionFilter)) toolCodeExportQ.Add("revision=" + Uri.EscapeDataString(Model.RevisionFilter));
    if (!string.IsNullOrEmpty(Model.ToolListNameFilter)) toolCodeExportQ.Add("toolListName=" + Uri.EscapeDataString(Model.ToolListNameFilter));
    if (!string.IsNullOrEmpty(Model.ProjectCodeFilter)) toolCodeExportQ.Add("projectCode=" + Uri.EscapeDataString(Model.ProjectCodeFilter));
    if (!string.IsNullOrEmpty(Model.MachineNameFilter)) toolCodeExportQ.Add("machineName=" + Uri.EscapeDataString(Model.MachineNameFilter));
    if (!string.IsNullOrEmpty(Model.MachineWorkcenterFilter)) toolCodeExportQ.Add("machineWorkcenter=" + Uri.EscapeDataString(Model.MachineWorkcenterFilter));
    if (!string.IsNullOrEmpty(Model.CreatedByFilter)) toolCodeExportQ.Add("createdBy=" + Uri.EscapeDataString(Model.CreatedByFilter));
    var toolCodeExportQuery = "?" + string.Join("&", toolCodeExportQ);
}
<div class="module-header">
    <h2>Tool Code Database with Tool List</h2>
    <div class="export-buttons">
        <a href="/ToolCode/Export@(toolCodeExportQuery)" class="btn btn-secondary btn-sm">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
            Excel
        </a>
        <a href="/ToolCode/Export@(toolCodeExportQuery.Replace("format=excel", "format=csv"))" class="btn btn-secondary btn-sm">CSV</a>
        <a href="/ToolCode/Export@(toolCodeExportQuery.Replace("format=excel", "format=txt"))" class="btn btn-secondary btn-sm">TXT</a>
    </div>
</div>

<div class="search-bar">
    <form method="get" id="searchForm">
        <div class="search-input-group">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
            <input type="text" name="search" value="@Model.SearchTerm" placeholder="Search tools..." class="search-input" id="searchInput" />
        </div>
        <button type="submit" class="btn btn-primary btn-sm">Search</button>
    </form>
</div>

<div class="table-container">
    <table class="data-table">
        <thead>
            <tr class="table-filter-row">
                <th></th>
                <th>
                    <select id="filterToolNumber" class="filter-cell-select" onchange="applyFilters()">
                        <option value="">All</option>
                        @foreach (var v in Model.AvailableToolNumbers) { if (Model.ToolNumberFilter == v) { <option value="@v" selected>@v</option> } else { <option value="@v">@v</option> } }
                    </select>
                </th>
                <th>
                    <select id="filterToolDescription" class="filter-cell-select" onchange="applyFilters()">
                        <option value="">All</option>
                        @foreach (var v in Model.AvailableToolDescriptions) { if (Model.ToolDescriptionFilter == v) { <option value="@v" selected>@v</option> } else { <option value="@v">@v</option> } }
                    </select>
                </th>
                <th>
                    <select id="filterConsumableCode" class="filter-cell-select" onchange="applyFilters()">
                        <option value="">All</option>
                        @foreach (var v in Model.AvailableConsumableCodes) { if (Model.ConsumableCodeFilter == v) { <option value="@v" selected>@v</option> } else { <option value="@v">@v</option> } }
                    </select>
                </th>
                <th>
                    <select id="filterSupplier" class="filter-cell-select" onchange="applyFilters()">
                        <option value="">All</option>
                        @foreach (var v in Model.AvailableSuppliers) { if (Model.SupplierFilter == v) { <option value="@v" selected>@v</option> } else { <option value="@v">@v</option> } }
                    </select>
                </th>
                <th>
                    <select id="filterHolderExtension" class="filter-cell-select" onchange="applyFilters()">
                        <option value="">All</option>
                        @foreach (var v in Model.AvailableHolderExtensions) { if (Model.HolderExtensionFilter == v) { <option value="@v" selected>@v</option> } else { <option value="@v">@v</option> } }
                    </select>
                </th>
                <th>
                    <select id="filterDiameter" class="filter-cell-select" onchange="applyFilters()">
                        <option value="">All</option>
                        @foreach (var v in Model.AvailableDiameters) { if (Model.DiameterFilter == v) { <option value="@v" selected>@v</option> } else { <option value="@v">@v</option> } }
                    </select>
                </th>
                <th>
                    <select id="filterFluteLength" class="filter-cell-select" onchange="applyFilters()">
                        <option value="">All</option>
                        @foreach (var v in Model.AvailableFluteLengths) { if (Model.FluteLengthFilter == v) { <option value="@v" selected>@v</option> } else { <option value="@v">@v</option> } }
                    </select>
                </th>
                <th>
                    <select id="filterProtrusionLength" class="filter-cell-select" onchange="applyFilters()">
                        <option value="">All</option>
                        @foreach (var v in Model.AvailableProtrusionLengths) { if (Model.ProtrusionLengthFilter == v) { <option value="@v" selected>@v</option> } else { <option value="@v">@v</option> } }
                    </select>
                </th>
                <th>
                    <select id="filterCornerRadius" class="filter-cell-select" onchange="applyFilters()">
                        <option value="">All</option>
                        @foreach (var v in Model.AvailableCornerRadii) { if (Model.CornerRadiusFilter == v) { <option value="@v" selected>@v</option> } else { <option value="@v">@v</option> } }
                    </select>
                </th>
                <th>
                    <select id="filterArborCode" class="filter-cell-select" onchange="applyFilters()">
                        <option value="">All</option>
                        @foreach (var v in Model.AvailableArborCodes) { if (Model.ArborCodeFilter == v) { <option value="@v" selected>@v</option> } else { <option value="@v">@v</option> } }
                    </select>
                </th>
                <th>
                    <select id="filterPartNumber" class="filter-cell-select" onchange="applyFilters()">
                        <option value="">All</option>
                        @foreach (var v in Model.AvailablePartNumbers) { if (Model.PartNumberFilter == v) { <option value="@v" selected>@v</option> } else { <option value="@v">@v</option> } }
                    </select>
                </th>
                <th>
                    <select id="filterOperation" class="filter-cell-select" onchange="applyFilters()">
                        <option value="">All</option>
                        @foreach (var v in Model.AvailableOperations) { if (Model.OperationFilter == v) { <option value="@v" selected>@v</option> } else { <option value="@v">@v</option> } }
                    </select>
                </th>
                <th>
                    <select id="filterRevision" class="filter-cell-select" onchange="applyFilters()">
                        <option value="">All</option>
                        @foreach (var v in Model.AvailableRevisions) { if (Model.RevisionFilter == v) { <option value="@v" selected>@v</option> } else { <option value="@v">@v</option> } }
                    </select>
                </th>
                <th>
                    <select id="filterToolListName" class="filter-cell-select" onchange="applyFilters()">
                        <option value="">All</option>
                        @foreach (var v in Model.AvailableToolListNames) { if (Model.ToolListNameFilter == v) { <option value="@v" selected>@v</option> } else { <option value="@v">@v</option> } }
                    </select>
                </th>
                <th>
                    <select id="filterProjectCode" class="filter-cell-select" onchange="applyFilters()">
                        <option value="">All</option>
                        @foreach (var v in Model.AvailableProjectCodes) { if (Model.ProjectCodeFilter == v) { <option value="@v" selected>@v</option> } else { <option value="@v">@v</option> } }
                    </select>
                </th>
                <th>
                    <select id="filterMachineName" class="filter-cell-select" onchange="applyFilters()">
                        <option value="">All</option>
                        @foreach (var v in Model.AvailableMachineNames) { if (Model.MachineNameFilter == v) { <option value="@v" selected>@v</option> } else { <option value="@v">@v</option> } }
                    </select>
                </th>
                <th>
                    <select id="filterMachineWorkcenter" class="filter-cell-select" onchange="applyFilters()">
                        <option value="">All</option>
                        @foreach (var v in Model.AvailableMachineWorkcenters) { if (Model.MachineWorkcenterFilter == v) { <option value="@v" selected>@v</option> } else { <option value="@v">@v</option> } }
                    </select>
                </th>
                <th>
                    <select id="filterCreatedBy" class="filter-cell-select" onchange="applyFilters()">
                        <option value="">All</option>
                        @foreach (var v in Model.AvailableCreatedBys) { if (Model.CreatedByFilter == v) { <option value="@v" selected>@v</option> } else { <option value="@v">@v</option> } }
                    </select>
                </th>
                <th></th>
                <th></th>
                <th>
                    <button type="button" class="btn btn-secondary btn-sm" onclick="clearFilters()">Clear</button>
                </th>
            </tr>
            <tr>
                <th onclick="sortBy('no')">No. @Html.Raw(GetSortIcon("no"))</th>
                <th onclick="sortBy('toolNumber')">Tool No. @Html.Raw(GetSortIcon("toolNumber"))</th>
                <th onclick="sortBy('toolDescription')">Tool Name @Html.Raw(GetSortIcon("toolDescription"))</th>
                <th onclick="sortBy('consumableCode')">Consumable Tool Description @Html.Raw(GetSortIcon("consumableCode"))</th>
                <th onclick="sortBy('supplier')">Tool Supplier @Html.Raw(GetSortIcon("supplier"))</th>
                <th onclick="sortBy('holderExtensionCode')">Tool Holder @Html.Raw(GetSortIcon("holderExtensionCode"))</th>
                <th onclick="sortBy('diameter')">Tool Diameter (D1) @Html.Raw(GetSortIcon("diameter"))</th>
                <th onclick="sortBy('fluteLength')">Flute Length (L1) @Html.Raw(GetSortIcon("fluteLength"))</th>
                <th onclick="sortBy('protrusionLength')">Tool Ext. Length (L2) @Html.Raw(GetSortIcon("protrusionLength"))</th>
                <th onclick="sortBy('cornerRadius')">Tool Corner Radius @Html.Raw(GetSortIcon("cornerRadius"))</th>
                <th onclick="sortBy('arborCode')">Arbor Description (or equivalent specs) @Html.Raw(GetSortIcon("arborCode"))</th>
                <th onclick="sortBy('partNumber')">Part Number @Html.Raw(GetSortIcon("partNumber"))</th>
                <th onclick="sortBy('operation')">Operation @Html.Raw(GetSortIcon("operation"))</th>
                <th onclick="sortBy('revision')">Revision @Html.Raw(GetSortIcon("revision"))</th>
                <th onclick="sortBy('toolListName')">Tool List Name @Html.Raw(GetSortIcon("toolListName"))</th>
                <th onclick="sortBy('projectCode')">Project Code @Html.Raw(GetSortIcon("projectCode"))</th>
                <th onclick="sortBy('machineName')">Machine Name @Html.Raw(GetSortIcon("machineName"))</th>
                <th onclick="sortBy('machineWorkcenter')">Machine Workcenter @Html.Raw(GetSortIcon("machineWorkcenter"))</th>
                <th onclick="sortBy('createdBy')">Created By @Html.Raw(GetSortIcon("createdBy"))</th>
                <th onclick="sortBy('createdDate')">Created Date @Html.Raw(GetSortIcon("createdDate"))</th>
                <th onclick="sortBy('lastModifiedDate')">Last Modified @Html.Raw(GetSortIcon("lastModifiedDate"))</th>
            </tr>
        </thead>
        <tbody>
            @if (Model.Tools.Count == 0)
            {
                <tr>
                    <td colspan="20" class="empty-state">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                        <p>No tools match your filters</p>
                        <button type="button" class="btn btn-primary btn-sm" onclick="clearFilters()">Reset Filters</button>
                    </td>
                </tr>
            }
            else
            {
                @for (int i = 0; i < Model.Tools.Count; i++)
                {
                    var tool = Model.Tools[i];
                    var no = (Model.CurrentPage - 1) * Model.PageSize + i + 1;
                    <tr>
                        <td>@no</td>
                        <td>@tool.ToolNumber</td>
                        <td>@tool.ToolDescription</td>
                        <td><a href="@BuildFilterUrl(tool.ConsumableCode, null)" class="cell-link">@tool.ConsumableCode</a></td>
                        <td>@tool.Supplier</td>
                        <td>@tool.HolderExtensionCode</td>
                        <td>@tool.Diameter.ToString("0.##")</td>
                        <td>@tool.FluteLength.ToString("0.##")</td>
                        <td>@tool.ProtrusionLength.ToString("0.##")</td>
                        <td>@tool.CornerRadius.ToString("0.##")</td>
                        <td>@tool.ArborCode</td>
                        <td>@tool.PartNumber</td>
                        <td>@tool.Operation</td>
                        <td>@tool.Revision</td>
                        <td><a href="@BuildFilterUrl(null, tool.ToolListName)" class="cell-link">@tool.ToolListName</a></td>
                        <td>@tool.ProjectCode</td>
                        <td>@tool.MachineName</td>
                        <td>@tool.MachineWorkcenter</td>
                        <td>@tool.CreatedBy</td>
                        <td>@tool.CreatedDate.ToString("yyyy-MM-dd HH:mm")</td>
                        <td>@tool.LastModifiedDate.ToString("yyyy-MM-dd HH:mm")</td>
                    </tr>
                }
            }
        </tbody>
    </table>
</div>

@if (Model.TotalItems > 0)
{
    var qb = new List<string>();
    if (!string.IsNullOrEmpty(Model.SearchTerm)) qb.Add("search=" + Uri.EscapeDataString(Model.SearchTerm));
    if (!string.IsNullOrEmpty(Model.ToolNumberFilter)) qb.Add("toolNumber=" + Uri.EscapeDataString(Model.ToolNumberFilter));
    if (!string.IsNullOrEmpty(Model.ToolDescriptionFilter)) qb.Add("toolDescription=" + Uri.EscapeDataString(Model.ToolDescriptionFilter));
    if (!string.IsNullOrEmpty(Model.ConsumableCodeFilter)) qb.Add("consumableCode=" + Uri.EscapeDataString(Model.ConsumableCodeFilter));
    if (!string.IsNullOrEmpty(Model.SupplierFilter)) qb.Add("supplier=" + Uri.EscapeDataString(Model.SupplierFilter));
    if (!string.IsNullOrEmpty(Model.HolderExtensionFilter)) qb.Add("holderExtension=" + Uri.EscapeDataString(Model.HolderExtensionFilter));
    if (!string.IsNullOrEmpty(Model.DiameterFilter)) qb.Add("diameter=" + Uri.EscapeDataString(Model.DiameterFilter));
    if (!string.IsNullOrEmpty(Model.FluteLengthFilter)) qb.Add("fluteLength=" + Uri.EscapeDataString(Model.FluteLengthFilter));
    if (!string.IsNullOrEmpty(Model.ProtrusionLengthFilter)) qb.Add("protrusionLength=" + Uri.EscapeDataString(Model.ProtrusionLengthFilter));
    if (!string.IsNullOrEmpty(Model.CornerRadiusFilter)) qb.Add("cornerRadius=" + Uri.EscapeDataString(Model.CornerRadiusFilter));
    if (!string.IsNullOrEmpty(Model.ArborCodeFilter)) qb.Add("arborCode=" + Uri.EscapeDataString(Model.ArborCodeFilter));
    if (!string.IsNullOrEmpty(Model.PartNumberFilter)) qb.Add("partNumber=" + Uri.EscapeDataString(Model.PartNumberFilter));
    if (!string.IsNullOrEmpty(Model.OperationFilter)) qb.Add("operation=" + Uri.EscapeDataString(Model.OperationFilter));
    if (!string.IsNullOrEmpty(Model.RevisionFilter)) qb.Add("revision=" + Uri.EscapeDataString(Model.RevisionFilter));
    if (!string.IsNullOrEmpty(Model.ToolListNameFilter)) qb.Add("toolListName=" + Uri.EscapeDataString(Model.ToolListNameFilter));
    if (!string.IsNullOrEmpty(Model.ProjectCodeFilter)) qb.Add("projectCode=" + Uri.EscapeDataString(Model.ProjectCodeFilter));
    if (!string.IsNullOrEmpty(Model.MachineNameFilter)) qb.Add("machineName=" + Uri.EscapeDataString(Model.MachineNameFilter));
    if (!string.IsNullOrEmpty(Model.MachineWorkcenterFilter)) qb.Add("machineWorkcenter=" + Uri.EscapeDataString(Model.MachineWorkcenterFilter));
    if (!string.IsNullOrEmpty(Model.CreatedByFilter)) qb.Add("createdBy=" + Uri.EscapeDataString(Model.CreatedByFilter));
    if (!string.IsNullOrEmpty(Model.SortColumn)) qb.Add("sortColumn=" + Uri.EscapeDataString(Model.SortColumn));
    if (!string.IsNullOrEmpty(Model.SortDirection)) qb.Add("sortDirection=" + Uri.EscapeDataString(Model.SortDirection));
    @await Html.PartialAsync("_Pagination", new PaginationViewModel
    {
        CurrentPage = Model.CurrentPage,
        TotalPages = Math.Max(1, Model.TotalPages),
        TotalItems = Model.TotalItems,
        PageSize = Model.PageSize,
        QueryBase = string.Join("&", qb)
    });
}

@section Scripts {
<script>
    document.getElementById('searchForm').addEventListener('submit', function(e) { e.preventDefault(); applyFilters(); });
    function applyFilters() {
        const params = new URLSearchParams();
        const search = document.getElementById('searchInput').value;
        const add = (name, id) => { const v = document.getElementById(id); if (v && v.value) params.set(name, v.value); };
        add('toolNumber', 'filterToolNumber');
        add('toolDescription', 'filterToolDescription');
        add('consumableCode', 'filterConsumableCode');
        add('supplier', 'filterSupplier');
        add('holderExtension', 'filterHolderExtension');
        add('diameter', 'filterDiameter');
        add('fluteLength', 'filterFluteLength');
        add('protrusionLength', 'filterProtrusionLength');
        add('cornerRadius', 'filterCornerRadius');
        add('arborCode', 'filterArborCode');
        add('partNumber', 'filterPartNumber');
        add('operation', 'filterOperation');
        add('revision', 'filterRevision');
        add('toolListName', 'filterToolListName');
        add('projectCode', 'filterProjectCode');
        add('machineName', 'filterMachineName');
        add('machineWorkcenter', 'filterMachineWorkcenter');
        add('createdBy', 'filterCreatedBy');
        if (search) params.set('search', search);
        window.location.href = '/ToolCode?' + params.toString();
    }
    
    function clearFilters() {
        window.location.href = '/ToolCode';
    }
    
    function sortBy(column) {
        const params = new URLSearchParams(window.location.search);
        const currentSort = params.get('sortColumn');
        const currentDir = params.get('sortDirection');
        
        params.set('sortColumn', column);
        params.set('sortDirection', (currentSort === column && currentDir === 'asc') ? 'desc' : 'asc');
        params.set('page', '1');
        
        window.location.href = '/ToolCode?' + params.toString();
    }
</script>
}

@functions {
    string GetSortIcon(string column)
    {
        if (Model.SortColumn?.ToLower() == column.ToLower())
        {
            return Model.SortDirection?.ToLower() == "desc" 
                ? "<span class='sort-icon'>&#9660;</span>" 
                : "<span class='sort-icon'>&#9650;</span>";
        }
        return "<span class='sort-icon sort-inactive'>&#9650;&#9660;</span>";
    }

    string BuildFilterUrl(string? overrideConsumable, string? overrideToolListName)
    {
        var q = new List<string>();
        var consumable = overrideConsumable ?? Model.ConsumableCodeFilter;
        var toolListName = overrideToolListName ?? Model.ToolListNameFilter;
        if (!string.IsNullOrEmpty(Model.SearchTerm)) q.Add("search=" + Uri.EscapeDataString(Model.SearchTerm));
        if (!string.IsNullOrEmpty(Model.ToolNumberFilter)) q.Add("toolNumber=" + Uri.EscapeDataString(Model.ToolNumberFilter));
        if (!string.IsNullOrEmpty(Model.ToolDescriptionFilter)) q.Add("toolDescription=" + Uri.EscapeDataString(Model.ToolDescriptionFilter));
        if (!string.IsNullOrEmpty(consumable)) q.Add("consumableCode=" + Uri.EscapeDataString(consumable));
        if (!string.IsNullOrEmpty(Model.SupplierFilter)) q.Add("supplier=" + Uri.EscapeDataString(Model.SupplierFilter));
        if (!string.IsNullOrEmpty(Model.HolderExtensionFilter)) q.Add("holderExtension=" + Uri.EscapeDataString(Model.HolderExtensionFilter));
        if (!string.IsNullOrEmpty(Model.DiameterFilter)) q.Add("diameter=" + Uri.EscapeDataString(Model.DiameterFilter));
        if (!string.IsNullOrEmpty(Model.FluteLengthFilter)) q.Add("fluteLength=" + Uri.EscapeDataString(Model.FluteLengthFilter));
        if (!string.IsNullOrEmpty(Model.ProtrusionLengthFilter)) q.Add("protrusionLength=" + Uri.EscapeDataString(Model.ProtrusionLengthFilter));
        if (!string.IsNullOrEmpty(Model.CornerRadiusFilter)) q.Add("cornerRadius=" + Uri.EscapeDataString(Model.CornerRadiusFilter));
        if (!string.IsNullOrEmpty(Model.ArborCodeFilter)) q.Add("arborCode=" + Uri.EscapeDataString(Model.ArborCodeFilter));
        if (!string.IsNullOrEmpty(Model.PartNumberFilter)) q.Add("partNumber=" + Uri.EscapeDataString(Model.PartNumberFilter));
        if (!string.IsNullOrEmpty(Model.OperationFilter)) q.Add("operation=" + Uri.EscapeDataString(Model.OperationFilter));
        if (!string.IsNullOrEmpty(Model.RevisionFilter)) q.Add("revision=" + Uri.EscapeDataString(Model.RevisionFilter));
        if (!string.IsNullOrEmpty(toolListName)) q.Add("toolListName=" + Uri.EscapeDataString(toolListName));
        if (!string.IsNullOrEmpty(Model.ProjectCodeFilter)) q.Add("projectCode=" + Uri.EscapeDataString(Model.ProjectCodeFilter));
        if (!string.IsNullOrEmpty(Model.MachineNameFilter)) q.Add("machineName=" + Uri.EscapeDataString(Model.MachineNameFilter));
        if (!string.IsNullOrEmpty(Model.MachineWorkcenterFilter)) q.Add("machineWorkcenter=" + Uri.EscapeDataString(Model.MachineWorkcenterFilter));
        if (!string.IsNullOrEmpty(Model.CreatedByFilter)) q.Add("createdBy=" + Uri.EscapeDataString(Model.CreatedByFilter));
        if (!string.IsNullOrEmpty(Model.SortColumn)) q.Add("sortColumn=" + Uri.EscapeDataString(Model.SortColumn));
        if (!string.IsNullOrEmpty(Model.SortDirection)) q.Add("sortDirection=" + Uri.EscapeDataString(Model.SortDirection));
        q.Add("page=1");
        return "/ToolCode?" + string.Join("&", q);
    }
}
